- job-template:
    name: '{name}-nightly-trigger'
    project-type: multijob
    node: cloud-trigger
    triggers:
      - timed: "@midnight"

    builders:
      - trigger-builds:
          - project: '{name}-nightly'
            condition: ALWAYS
            predifined-parameters: |
              deployment=helm
      - trigger-builds:
          - project: '{name}-nightly'
            condition: ALWAYS
            predifined-parameters: |
              deployment=airship

- job-template:
    name: '{name}-nightly'
    project-type: pipeline
    number-to-keep: 30
    days-to-keep: 30
    branch: master
    parameters:
      - string:
          name: branch
          default: '{branch}'
          description: The branch to checkout
      - choice:
          name: deployment
          choices:
            - 'helm'
            - 'airship'
          description: Whether to deploy with airship or helm directly
    pipeline-scm:
      scm:
        - git:
            url: 'https://github.com/{repo-owner}/{repo-name}.git'
            credentials-id: '{repo-credentials}'
            branches:
              - '{branch}'
            browser: auto
            suppress-automatic-scm-triggering: true
      script-path: Jenkinsfile.integration
