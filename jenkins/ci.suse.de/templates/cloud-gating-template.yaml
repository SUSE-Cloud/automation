- job-template:
    name: '{cloud_gating_job}'
    project-type: pipeline
    disabled: '{obj:disabled|False}'
    concurrent: '{concurrent|False}'

    logrotate:
      numToKeep: -1
      daysToKeep: 30

    parameters:
      - validating-string:
          name: cloud_env
          default: '{cloud_env|}'
          regex: '[A-Za-z0-9-]+'
          msg: >-
            Empty or malformed value (only alphanumeric and '-' characters are allowed).
          description: >-
            The Lockable Resource label representing the resource pool to used by this job.

      - string:
          name: git_automation_repo
          default: '{git_automation_repo|https://github.com/SUSE-Cloud/automation.git}'
          description: >-
            The git automation repository to use

      - string:
          name: git_automation_branch
          default: '{git_automation_branch|master}'
          description: >-
            The git automation branch

      - hidden:
          name: version
          default: '{version}'
          description: >-
            Cloud version number (7, 8, 9 etc.)

      - hidden:
          name: skip_submit_project
          default: '{skip_submit_project|false}'
          description:
            Set to true to skip the submit project step

      - text:
          name: extra_params
          default: '{extra_params|}'
          description: >-
            This field may be used to define additional parameters,
            one per line, in the form PARAMETER_NAME=PARAMETER-VALUE.
            These parameters will be injected into the Jenkins job as
            environment variables that supplement or override the
            other parameters configured for the Jenkins job. This
            should not be used by default or regularly. It is meant to
            run job build customized in ways not already supported by
            the job's parameters, such as testing automation git pull
            requests with special configurations.

    logrotate:
      numToKeep: -1
      daysToKeep: 14


    pipeline-scm:
      scm:
        - git:
            url: https://github.com/SUSE-Cloud/automation.git
            #bug in lightweight checkout ${{git_automation_repo}}
            branches:
              - master
                #${{git_automation_branch}}
            browser: auto
            wipe-workspace: false
      script-path: jenkins/ci.suse.de/pipelines/cloud-gating.Jenkinsfile
      lightweight-checkout: true
