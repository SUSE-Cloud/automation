interaction_dirs:
  - ./interactions
template:
  mkcloud_parameters: &mkcloud_automation_parameters
    standard: &mkcloud_automation_standard
      label: openstack-mkcloud
      mkcloudtarget: all_noreboot
      cloudsource: develcloud9
      nodenumber: 2
      networkingplugin: openvswitch
    stable: &mkcloud_automation_stable
      <<: *mkcloud_automation_standard
      cloudsource: GM8+up
  ardana_parameters: &ardana_automation_parameters
    standard: &ardana_automation_standard
      label: cloud-ardana-ci
  user:
    suse_cloud_user: &suse_cloud_user
      - SUSE-Cloud
  team:
    suse_cloud_team: &suse_cloud_team
      - name: SUSE-Cloud/Owners
        id: 159206
      - name: SUSE-Cloud/developers
        id: 1541628
    crowbar_team: &crowbar_team
      - name: crowbar/Owners
        id: 291046
  filter:
    suse_automation: &suse_automation_mkcloud
      - &merge type: MergeBranch
        config:
          branches:
            - master
      - &unseen type: Status
        config:
          status: unseen
      - &trusted type: TrustedSource
        skippable: true
        config:
          users:
            *suse_cloud_user
          teams:
            *suse_cloud_team
        blacklist_handler:
          - type: SetStatus
            parameters:
              status: error
              message: Owner of the source repo for this PR lacks permission
      - type: FileMatch
        config:
          paths:
            -  !ruby/regexp '/scripts\/(mkcloud|qa_crowbarsetup\.sh|lib\/.*)$/'
            -  !ruby/regexp '/scripts\/jenkins\/(log-parser|mkcloud)\//'
        blacklist_handler:
          - type: SetStatus
            parameters:
              status: success
              message: Gating not applicable
        whitelist_handler:
          - type: SetStatus
            parameters:
              status: pending
              message: Queued automation PR gating
          - type: JenkinsJobTriggerMkcloud
            parameters:
              detail_logging: true
              job_name: openstack-mkcloud
              job_cmd: "../jenkins/jenkins-job-trigger"
              job_parameters:
                *mkcloud_automation_parameters
    suse_automation: &suse_automation_ardana
      - *merge
      - *unseen
      - *trusted
      - type: FileMatch
        config:
          pass_through: all
          paths:
            -  !ruby/regexp '/scripts\/jenkins\/ardana\//'
            -  !ruby/regexp '/jenkins\/ci.suse.de\/pipelines\/openstack-ardana.*\.Jenkinsfile$/'
        whitelist_handler:
          - type: SetStatus
            parameters:
              status: pending
              message: Queued automation PR gating
          - type: JenkinsJobTriggerArdana
            parameters:
              detail_logging: true
              job_name: openstack-ardana
              job_cmd: "../jenkins/jenkins-job-trigger"
              job_parameters:
                <<: *ardana_automation_parameters
    suse_cct: &suse_cct
      - type: Status
        config:
          status: unseen
      - type: TrustedSource
        config:
          users:
            *suse_cloud_user
          teams:
            *suse_cloud_team
        blacklist_handler:
          - type: SetStatus
            parameters:
              status: error
              message: Owner of the source repo for this PR lacks permission
        whitelist_handler:
          - type: SetStatus
            parameters:
              status: pending
              message: Queued cct PR gating
          - type: JenkinsJobTriggerMkcloudCCT
            parameters:
              detail_logging: true
              job_name: openstack-mkcloud
              job_cmd: "../jenkins/jenkins-job-trigger"
              job_parameters:
                standard:
                  *mkcloud_automation_standard
pr_processing:
  - config:
      organization: SUSE-Cloud
      repositories:
        - automation
      context: suse/mkcloud
    filter: *suse_automation_mkcloud
  - config:
      organization: SUSE-Cloud
      repositories:
        - automation
      context: suse/mkcloud/ardana
    filter: *suse_automation_ardana
  - config:
      organization: SUSE-Cloud
      repositories:
        - cct
      context: suse/mkcloud
    filter: *suse_cct
