#!/bin/bash

cloudfunc=~/cloud.d/cloudfunc
test -e $cloudfunc || cloudfunc=$(dirname $(readlink -e $BASH_SOURCE))/cloudfunc
. $cloudfunc

host_letter=$(hostname | cut -b5)
base_dir=$(dirname $(dirname $(readlink -e $0)))
snippet=$($base_dir/lib/ipv6/radvd-conf-template)
radvd_conf=$(mktemp)
cat <<EOF>$radvd_conf
# Automatically generated by $0

EOF

for num in $(seq 1 9); do
    prefix=$(ipv6prefix $num)
    interface="v${host_letter}${num}br"
    sed -e "s/<INTERFACE>/$interface/" -e "s/<PREFIX>/$prefix/" < $snippet >> $radvd_conf
done
rm $snippet
chmod 0644 $radvd_conf
echo "Config file written to $radvd_conf"

